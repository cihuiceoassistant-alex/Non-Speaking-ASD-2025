<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025年有限口語自閉症者國際研討會報名</title>
    <style>
        :root{--pink:#e27d9a;--gray:#e9ecef;--light:#fdfafa;--bg:#ffffff;--focus:#e27d9a22;--text:#444444}
        body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Microsoft JhengHei",sans-serif;background:#f8f9fb;padding:20px;margin:0;line-height:1.7;color:var(--text)}
        .c{max-width:760px;margin:0 auto;background:var(--bg);border-radius:26px;overflow:hidden;box-shadow:0 16px 50px rgba(226,125,154,.15)}
        .h{background:linear-gradient(135deg,#eba1b5,var(--pink));color:white;padding:46px 36px;text-align:center}
        .h h1{font-size:24px;line-height:1.45;font-weight:600;margin:0}
        .i{padding:42px 36px;background:var(--light);line-height:1.9;font-size:16px;color:#555}
        .i strong{color:var(--pink)}
        form{padding:0 36px 46px 36px}
        label{display:block;margin:28px 0 10px;font-weight:600;font-size:15.8px;color:#555}
        input,select,textarea{width:100%;padding:17px 22px;border:2px solid var(--gray);border-radius:18px;font-size:16px;box-sizing:border-box;background:white;transition:all .3s}
        input:focus,select:focus,textarea:focus{border-color:var(--pink);outline:none;box-shadow:0 0 0 6px var(--focus)}
        select{height:58px} textarea{height:124px;resize:vertical}
        .agree-box{margin:34px 0 10px;padding:26px;background:#fff9fb;border:2px solid #f5d9e3;border-radius:20px}
        .agree-box label{margin:0;font-weight:normal;font-size:15.8px;line-height:1.85;display:flex;gap:18px;align-items:flex-start;cursor:pointer}
        .agree-box input[type="checkbox"]{width:27px;height:27px;border-radius:10px;flex-shrink:0;accent-color:var(--pink)}
        .agree-box strong{color:var(--pink)}
        button{width:100%;padding:20px;background:#ced6e0;color:#888;border:none;border-radius:20px;font-size:18px;font-weight:bold;cursor:not-allowed;transition:all .35s;margin-top:14px}
        button.active{background:var(--pink);color:white;cursor:pointer;box-shadow:0 10px 28px rgba(226,125,154,.35)}
        button.loading{background:#d65a7f;pointer-events:none}
        #dietDetails{display:none;margin-top:16px}
        .ok,.error{margin:32px 36px;padding:30px;border:2px solid #f5d9e3;border-radius:20px;text-align:center;font-size:18.5px;font-weight:bold;display:none}
        .ok{background:#fff5f8;color:var(--pink)}
        .error{background:#fff5f5;color:#e74c3c;border-color:#f5d9d9}
        .loading-text::after{content:' .';animation:dot 1.5s infinite}
        @keyframes dot{0%,20%{content:' .'}40%{content:' ..'}60%{content:' ...'}80%,100%{content:' .'}}
    </style>
</head>

<body>
<div class="c">
    <div class="h"><h1>2025年「有限口語自閉症者國際研討會<br>—共融、共創、共進」報名表</h1></div>

    <form id="seminarForm">
        <input type="hidden" id="timestamp">

        <label>姓名 *</label>
        <input type="text" id="name" required>

        <label>電子信箱 *</label>
        <input type="email" id="email" required>

        <label>行動電話號碼 *</label>
        <input type="tel" id="phone" required>

        <label>服務單位／就讀學校</label>
        <input type="text" id="unit">

        <label>職稱／身份</label>
        <input type="text" id="title">

        <label>您預計參加場次 *</label>
        <select id="session" required>
            <option value="">請選擇</option>
            <option value="12月20日（六）">12月20日（六）</option>
            <option value="12月21日（日）">12月21日（日）</option>
            <option value="兩天皆參加">兩天皆參加</option>
        </select>

        <label>您是否需要特殊協助或無障礙服務？ *</label>
        <textarea id="assist" required placeholder="如：輪椅席位、手語翻譯。若無請填「無」"></textarea>

        <label>午餐調查 *</label>
        <select id="diet" required onchange="document.getElementById('dietDetails').style.display=this.value==='有過敏或特殊飲食需求'?'block':'none'">
            <option value="">請選擇</option>
            <option value="無特殊需求">無特殊需求</option>
            <option value="有過敏或特殊飲食需求">有過敏或特殊飲食需求</option>
        </select>

        <div id="dietDetails">
            <input type="text" id="dietDetail" placeholder="請說明過敏原或飲食限制">
        </div>

        <label>參加場次 - 用餐素食</label>
        <input type="text" id="mealVegetarian" placeholder="若無請留空">

        <label>參加場次 - 不用餐</label>
        <input type="text" id="mealNo" placeholder="若無請留空">

        <div class="agree-box">
            <label>
                <input type="checkbox" id="confirm" required>
                <span><strong>報名確認 *</strong><br>我確認以上資訊正確並願意報名此活動。</span>
            </label>
        </div>

        <button type="submit" id="btn">送出報名</button>

        <div id="ok" class="ok">報名成功！感謝您的參與。</div>
        <div id="error" class="error">送出失敗，請稍後再試。</div>
    </form>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw_LpPTvuRysA2wzv4J4V5YFG7Zi91AcGlqWBwSoRk_wz3YEsj30p6iFVeaihVeEx60hA/exec";

// 啟用按鈕樣式
document.getElementById("confirm").addEventListener("change", e => {
    const btn = document.getElementById("btn");
    if (e.target.checked) btn.classList.add("active");
    else btn.classList.remove("active");
});

//送出表單
document.getElementById("seminarForm").addEventListener("submit", async e => {
    e.preventDefault();

    const btn = document.getElementById("btn");
    btn.classList.add("loading");
    btn.textContent = "傳送中...";

    // 時間戳記
    document.getElementById("timestamp").value =
        new Date().toLocaleString("zh-TW", { timeZone: "Asia/Taipei" });

    // 建立 FormData（避免 CORS）
    const fd = new FormData();
    const fields = [
        "timestamp","name","email","phone","unit","title","session",
        "assist","diet","dietDetail","mealVegetarian","mealNo","confirm"
    ];

    fields.forEach(id => {
        const el = document.getElementById(id);
        fd.append(id, el?.value || "");
    });

    try {
        const res = await fetch(SCRIPT_URL, {
            method: "POST",
            body: fd   // ❗ 無 headers → 不會觸發預檢 → 不會觸發 CORS
        });

        const json = await res.json();

        if (json.status === "success") {
            document.getElementById("ok").style.display = "block";
            document.getElementById("seminarForm").reset();
            document.getElementById("dietDetails").style.display = "none";
        } else {
            document.getElementById("error").style.display = "block";
        }
    } catch (err) {
        console.error(err);
        document.getElementById("error").style.display = "block";
    }

    btn.classList.remove("loading");
    btn.textContent = "送出報名";
});
</script>

</body>
</html>
